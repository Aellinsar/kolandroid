package com.github.kolandroid.kol.android.controllers;

import android.view.View;
import android.view.View.OnClickListener;
import android.widget.TextView;

import com.github.kolandroid.kol.android.R;
import com.github.kolandroid.kol.android.controller.LinkedModelController;
import com.github.kolandroid.kol.android.screen.Screen;
import com.github.kolandroid.kol.android.screen.ScreenSelection;
import com.github.kolandroid.kol.android.util.ProgressBar;
import com.github.kolandroid.kol.model.LiveModel.LiveMessage;
import com.github.kolandroid.kol.model.models.StatsModel;

public class StatsController extends LinkedModelController<LiveMessage, StatsModel> {
    /**
     * Autogenerated by eclipse.
     */
    private static final long serialVersionUID = -5515046804414654496L;

    public StatsController(StatsModel model) {
        super(model);
    }

    @Override
    public int getView() {
        return R.layout.stats_small_view;
    }

    @Override
    public void attach(View view, final StatsModel model, Screen host) {
        view.setOnClickListener(new OnClickListener() {
            @Override
            public void onClick(View arg0) {
                model.loadFull();
            }
        });

        StatsCallbacks activity = (StatsCallbacks) host.getActivity();
        activity.register(this);

        this.refresh();
    }

    public void receiveProgress(View view, StatsModel model, LiveMessage message, Screen host) {
        StatsCallbacks activity = (StatsCallbacks) host.getActivity();
        if (activity != null) {
            activity.update(model.getUsername(), model.getCharInfo());
        }

        TextView txtMuscle = (TextView) view.findViewById(R.id.stats_muscle);
        String muscle = model.getMuscle() + " (" + model.getMuscleBase() + ")";
        txtMuscle.setText(muscle);

        TextView txtMyst = (TextView) view.findViewById(R.id.stats_myst);
        String myst = model.getMyst() + " (" + model.getMystBase() + ")";
        txtMyst.setText(myst);

        TextView txtMoxie = (TextView) view.findViewById(R.id.stats_moxie);
        String moxie = model.getMoxie() + " (" + model.getMoxieBase() + ")";
        txtMoxie.setText(moxie);

        ProgressBar barHP = (ProgressBar) view.findViewById(R.id.stats_hp);
        barHP.setProgress(model.getHP(), model.getHPBase());

        ProgressBar barMP = (ProgressBar) view.findViewById(R.id.stats_mp);
        barMP.setProgress(model.getMP(), model.getMPBase());

        TextView txtAdv = (TextView) view.findViewById(R.id.stats_adventures);
        txtAdv.setText(model.getAdv() + "");

        TextView txtMeat = (TextView) view.findViewById(R.id.stats_meat);
        txtMeat.setText(model.getMeat() + "");
    }

    public void refresh() {
        getModel().update();
    }

    public void showQuests() {
        getModel().loadQuests();
    }

    @Override
    public void chooseScreen(ScreenSelection choice) {
        choice.displayPrimary(this);
    }

    public interface StatsCallbacks {
        void update(String username, String subtext);

        void register(StatsController statController);
    }
}
