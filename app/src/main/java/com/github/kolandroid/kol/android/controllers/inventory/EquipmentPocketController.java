package com.github.kolandroid.kol.android.controllers.inventory;

import android.view.View;
import android.view.View.OnClickListener;
import android.widget.Button;

import com.github.kolandroid.kol.android.R;
import com.github.kolandroid.kol.android.binders.ColoredGroupBinder;
import com.github.kolandroid.kol.android.binders.ElementBinder;
import com.github.kolandroid.kol.android.binders.SubtextBinder;
import com.github.kolandroid.kol.android.controller.Controller;
import com.github.kolandroid.kol.android.controller.LinkedModelController;
import com.github.kolandroid.kol.android.screen.DialogScreen;
import com.github.kolandroid.kol.android.screen.Screen;
import com.github.kolandroid.kol.android.screen.ScreenSelection;
import com.github.kolandroid.kol.android.screen.ViewScreen;
import com.github.kolandroid.kol.android.util.searchlist.GroupSearchListController;
import com.github.kolandroid.kol.android.util.searchlist.SerializableSelector;
import com.github.kolandroid.kol.model.LiveModel.LiveMessage;
import com.github.kolandroid.kol.model.models.inventory.EquipmentPocketModel;
import com.github.kolandroid.kol.model.models.inventory.InventoryItem;

public class EquipmentPocketController extends LinkedModelController<LiveMessage, EquipmentPocketModel> {
    /**
     * Autogenerated by eclipse.
     */
    private static final long serialVersionUID = 5593217234616379830L;
    private static final SerializableSelector<InventoryItem> displayPossibleActions = new SerializableSelector<InventoryItem>() {
        /**
         * Autogenerated by eclipse.
         */
        private static final long serialVersionUID = 6502795666816716450L;

        @Override
        public boolean selectItem(Screen host, InventoryItem item) {
            ItemController controller = new ItemController(item);
            DialogScreen.display(controller, host);
            return false;
        }
    };
    private final int groupColor;
    private transient GroupSearchListController<InventoryItem> list;

    public EquipmentPocketController(EquipmentPocketModel model, int groupColor) {
        super(model);
        this.groupColor = groupColor;
    }

    @Override
    public int getView() {
        return R.layout.fragment_equipment_pane;
    }

    @Override
    public void chooseScreen(ScreenSelection choice) {
        choice.displayPrimary(this);
    }

    @Override
    public void receiveProgress(View view, EquipmentPocketModel model, LiveMessage message, Screen host) {
        if (list != null)
            list.setItems(model.getItems());
    }

    @Override
    public void connect(View view, final EquipmentPocketModel model, final Screen host) {

        ViewScreen screen = (ViewScreen) view.findViewById(R.id.inventory_list);
        list = new GroupSearchListController<InventoryItem>(model.getItems(), new ColoredGroupBinder(groupColor), SubtextBinder.ONLY, displayPossibleActions);
        screen.display(list, host);

        Button equipoutfit = (Button) view.findViewById(R.id.equipment_equipoutfit);
        equipoutfit.setOnClickListener(new OnClickListener() {
            @Override
            public void onClick(View arg0) {
                Controller c = GroupSearchListController.create(model.getOutfits(), new ColoredGroupBinder(groupColor), ElementBinder.ONLY);
                DialogScreen.display(c, host, "Equip outfit");
            }
        });

        Button saveoutfit = (Button) view.findViewById(R.id.equipment_saveoutfit);
        saveoutfit.setOnClickListener(new OnClickListener() {
            @Override
            public void onClick(View v) {
                Controller c = new CustomOutfitController(model.saveOutfit());
                DialogScreen.display(c, host);
            }
        });
    }
}
