package com.starfish.kol.android.controller;

import android.os.Bundle;
import android.view.View;
import android.widget.TabHost.TabSpec;

import com.starfish.kol.android.R;
import com.starfish.kol.android.screen.FragmentScreen;
import com.starfish.kol.android.screen.Screen;
import com.starfish.kol.android.util.CustomFragmentTabHost;
import com.starfish.kol.model.GroupModel;

public abstract class GroupController<C, M extends GroupModel<C>>
		extends ModelController<Void, M> {
	/**
	 * Autogenerated by eclipse.
	 */
	private static final long serialVersionUID = 5797782671758587158L;

	public GroupController(M model) {
		super(model);
	}

	@Override
	public int getView() {
		return R.layout.fragment_tabs_screen;
	}

	protected abstract Controller getController(C child);
	
	@Override
	public void connect(View view, M model, Screen host) {
		final CustomFragmentTabHost tabHost = (CustomFragmentTabHost) view
				.findViewById(R.id.tabs_tabhost);
		tabHost.setup(host.getActivity(), host.getChildFragmentManager(),
				R.id.tabs_tabcontent);
		
		C[] children = model.getChildren();
		String[] names = model.getNames();
		
		for(int i = 0; i < children.length; i++) {
			Controller c = getController(children[i]);
			Bundle bundle = FragmentScreen.prepare(c);
			TabSpec tab = tabHost.newTabSpec(names[i]).setIndicator(names[i]);
			tabHost.addTab(tab, FragmentScreen.class, bundle);
		}
	}
}
