package com.starfish.kol.android.controller;

import java.lang.ref.WeakReference;

import android.view.View;

import com.starfish.kol.android.screen.Screen;
import com.starfish.kol.model.Model;

public abstract class UpdatableModelController<C, M extends Model<C>> extends ModelController<C, M> implements UpdatableController<M>  {
	/**
	 * Autogenerated by eclipse.
	 */
	private static final long serialVersionUID = 8000096303272331462L;
	
	private transient WeakReference<Screen> currentScreen;
	private transient WeakReference<View> currentView;
	
	public UpdatableModelController(M model) {
		super(model);
		
		this.currentView = new WeakReference<View>(null);
		this.currentScreen = new WeakReference<Screen>(null);
	}

	@Override
	public void connect(final View view, final Screen host) {
		this.currentView = new WeakReference<View>(view);
		this.currentScreen = new WeakReference<Screen>(host);
		
		super.connect(view, host);
	}

	@Override
	public void disconnect(Screen host) {
		super.disconnect(host);

		this.currentView = new WeakReference<View>(null);
		this.currentScreen = new WeakReference<Screen>(null);
	}

	public void updateModel(M model) {
		this.setModel(model);
		
		View view = currentView.get();
		Screen screen = currentScreen.get();
		if(view != null && screen != null) {
			connect(view, screen);
		}
	}
}
