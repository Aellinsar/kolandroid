package com.starfish.kol.model.elements;

import com.starfish.kol.connection.Session;
import com.starfish.kol.model.elements.basic.BasicAction;
import com.starfish.kol.model.elements.basic.BasicSubtextElement;
import com.starfish.kol.model.elements.interfaces.DeferredGameAction;
import com.starfish.kol.util.Regex;

public class SkillElement extends BasicSubtextElement {
	/**
	 * Autogenerated by eclipse.
	 */
	private static final long serialVersionUID = 7468444853147077407L;

	private static final Regex OPTION_MP = new Regex("\\(.*?\\)", 0);
	
	private final boolean disabled;
	private final String actionBase;
	private final boolean buff;

	private final Session session;
	
	public SkillElement(Session session, String name, String subtext, String actionBase,
			boolean disabled, boolean buff) {
		super(name, "", subtext);

		this.actionBase = actionBase;
		this.disabled = disabled;
		this.buff = buff;
		
		this.session = session;
	}

	public static SkillElement make(Session session, OptionElement option, String actionBase,
			boolean isBuff) {
		String name = option.text;
		String subtext = OPTION_MP.extractSingle(name); // mp cost of skill
		if(subtext == null)
			subtext = "";

		name = OPTION_MP.replaceAll(name, ""); // remove mp from skill name
		return new SkillElement(session, name, subtext, actionBase + "&whichskill=" + option.value, option.disabled, isBuff);
	}
	
	public boolean getIsDisabled() {
		return disabled;
	}
	
	public boolean isBuff() {
		return buff;
	}
	
	public DeferredGameAction cast(String number, String onPlayer) {
		String action = actionBase;
		if(buff) {
			//do something with onPlayer
			action += "&specificplayer=" + onPlayer;
			action += "&bufftimes=" + number;
		} else {
			action += "&quantity=" + number;
		}
		
		return new BasicAction(session, action);
	}
}